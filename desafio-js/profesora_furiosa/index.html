<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Desafio Javascript</title>
    <link rel="shortcut icon" href="../../favicon.svg" />
    <link rel="stylesheet" href="../../dist/tailwind.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .font-main {
        font-family: "Space Grotesk", sans-serif;
      }
      main.grid {
        grid-template-columns: 12rem 1fr;
        grid-template-rows: 40px 194px 1fr 1fr;
        grid-template-areas:
          "title title"
          "nav content"
          ". content"
          ". content";
        height: calc(100vh - 56px);
      }
      h1 {
        grid-area: title;
      }
      .layout-nav {
        width: 12rem;
        grid-area: nav;
      }
      .layout-content {
        grid-area: content;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-200 font-main min-h-screen">
    <header class="p-4 bg-gray-800 shadow-lg flex justify-between">
      <section class="flex space-x-2">
        <img class="w-6 h-6" src="../../favicon.svg" alt="Mi logo" />
        <h2>Casita Virtual</h2>
      </section>
      <section>
        <a
          href="/1_class/"
          class="flex space-x-2 px-2 rounded transition duration-200 ease-in-out opacity-75 hover:bg-gray-700 hover:shadow hover:text-indigo-500"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            class="w-6 h-6 fill-current"
          >
            <path
              d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"
            />
          </svg>
          <h2>Clases</h2>
        </a>
      </section>
    </header>
    <main class="p-6 grid">
      <h1 class="text-2xl font-bold flex items-center space-x-2 mb-4">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          class="w-10 h-10 fill-current text-indigo-500"
        >
          <path
            fill-rule="evenodd"
            d="M9.504 1.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 3.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1zM5.618 4.504a1 1 0 01-.372 1.364L5.016 6l.23.132a1 1 0 11-.992 1.736L4 7.723V8a1 1 0 01-2 0V6a.996.996 0 01.52-.878l1.734-.99a1 1 0 011.364.372zm8.764 0a1 1 0 011.364-.372l1.733.99A1.002 1.002 0 0118 6v2a1 1 0 11-2 0v-.277l-.254.145a1 1 0 11-.992-1.736l.23-.132-.23-.132a1 1 0 01-.372-1.364zm-7 4a1 1 0 011.364-.372L10 8.848l1.254-.716a1 1 0 11.992 1.736L11 10.58V12a1 1 0 11-2 0v-1.42l-1.246-.712a1 1 0 01-.372-1.364zM3 11a1 1 0 011 1v1.42l1.246.712a1 1 0 11-.992 1.736l-1.75-1A1 1 0 012 14v-2a1 1 0 011-1zm14 0a1 1 0 011 1v2a1 1 0 01-.504.868l-1.75 1a1 1 0 11-.992-1.736L16 13.42V12a1 1 0 011-1zm-9.618 5.504a1 1 0 011.364-.372l.254.145V16a1 1 0 112 0v.277l.254-.145a1 1 0 11.992 1.736l-1.735.992a.995.995 0 01-1.022 0l-1.735-.992a1 1 0 01-.372-1.364z"
            clip-rule="evenodd"
          />
        </svg>
        <span> Desafio </span>
      </h1>
      <nav class="layout-nav pt-6">
        <ul class="space-y-3">
          <li>
            <a
              href="/desafio-js/productoria"
              data-level="productoria"
              class="flex space-x-2 transition duration-200 ease-out hover:bg-gray-800 hover:text-indigo-400 px-3 py-1 rounded-l"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                class="w-6 h-6 fill-current"
              >
                <path
                  d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"
                />
              </svg>
              <span> Productoria </span>
            </a>
          </li>
          <li>
            <a
              href="/desafio-js/escalera"
              data-level="escalera"
              class="flex space-x-2 transition duration-200 ease-out hover:bg-gray-800 hover:text-indigo-400 px-3 py-1 rounded-l"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                class="w-6 h-6 fill-current"
              >
                <path
                  d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
                />
              </svg>
              <span> Escalera </span>
            </a>
          </li>
          <li>
            <a
              href="/desafio-js/profesora_furiosa"
              data-level="profesora_furiosa"
              class="flex space-x-2 transition duration-200 ease-out hover:bg-gray-800 hover:text-indigo-400 px-3 py-1 rounded-l"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                class="w-6 h-6 fill-current"
              >
                <path
                  d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"
                />
              </svg>
              <span>Profesora furiosa</span>
            </a>
          </li>
          <li>
            <a
              href="/desafio-js/arbol_utopico"
              data-level="arbol_utopico"
              class="flex space-x-2 transition duration-200 ease-out hover:bg-gray-800 hover:text-indigo-400 px-3 py-1 rounded-l"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                class="w-6 h-6 fill-current"
              >
                <path
                  fill-rule="evenodd"
                  d="M17.778 8.222c-4.296-4.296-11.26-4.296-15.556 0A1 1 0 01.808 6.808c5.076-5.077 13.308-5.077 18.384 0a1 1 0 01-1.414 1.414zM14.95 11.05a7 7 0 00-9.9 0 1 1 0 01-1.414-1.414 9 9 0 0112.728 0 1 1 0 01-1.414 1.414zM12.12 13.88a3 3 0 00-4.242 0 1 1 0 01-1.415-1.415 5 5 0 017.072 0 1 1 0 01-1.415 1.415zM9 16a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Árbol utópico</span>
            </a>
          </li>
          <li>
            <a
              href="/desafio-js/factorial"
              data-level="factorial"
              class="flex space-x-2 transition duration-200 ease-out hover:bg-gray-800 hover:text-indigo-400 px-3 py-1 rounded-l"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                class="w-6 h-6 fill-current"
              >
                <path
                  fill-rule="evenodd"
                  d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-1h5v2H5a1 1 0 01-1-1zm7 1h4a1 1 0 001-1v-1h-5v2zm0-4h5V8h-5v2zM9 8H4v2h5V8z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Factorial</span>
            </a>
          </li>
        </ul>
      </nav>
      <section class="layout-content p-8 pt-0 pl-0">
        <article class="bg-gray-800 rounded shadow-xl h-full relative">
          <aside class="contentIndicator absolute top-0 right-0 m-2"></aside>
          <main class="contentBox p-6 space-y-2">
            <h3
              class="text-2xl font-normal underline uppercase text-indigo-500"
            ></h3>
            <p></p>
            <ul class="flex flex-wrap gap-2"></ul>
          </main>
        </article>
      </section>
    </main>
    <script>
      const contentIndicator = document.querySelector(".contentIndicator");
      const contentBox = document.querySelector(".contentBox");

      const loadJSON = (callback) => {
        let xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open("GET", "../challenge.json", true);
        // Replace 'my_data' with the path to your file
        xobj.onreadystatechange = () => {
          if (xobj.readyState === 4 && xobj.status === 200) {
            // Required use of an anonymous callback
            // as .open() will NOT return a value but simply returns undefined in asynchronous mode
            callback(xobj.responseText);
          }
        };
        xobj.send(null);
      };
      const chancgeContentState = (state) => {
        const ready = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="w-4 h-4 fill-current text-teal-500">
  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
</svg>`;
        const idle = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="w-4 h-4 fill-current text-yellow-500">
  <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
  <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
</svg>`;
        const looking = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="w-4 h-4 fill-current text-indigo-500">
  <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
</svg>`;
        let content = null;
        if (state === "idle") {
          content = idle;
        } else if (state === "looking") {
          content = looking;
        } else if (state === "ready") {
          content = ready;
        }
        contentState = state;
        contentIndicator.innerHTML = content;
      };
      let contentState = null;
      chancgeContentState("idle");
      let challangeData = null;
      const init = () => {
        chancgeContentState("looking");
        loadJSON((response) => {
          // Parse JSON string into object
          challangeData = JSON.parse(response);
          chancgeContentState("ready");
        });
      };
      init();

      const updateTitle = (data) => {
        const defaultTitle = "Desafio Javascript";
        if (data) {
          document.title = defaultTitle + " || " + data;
          return true;
        }
        document.title = defaultTitle;
      };
      const clearLinkSelection = (qs) => {
        document.querySelectorAll(qs).forEach((elem) => {
          elem.classList.remove("bg-gray-800", "text-indigo-400");
        });
      };
      const selectLink = (element) => {
        element.classList.add("bg-gray-800", "text-indigo-400");
      };
      const getElementByLevel = (level) => {
        return document.querySelector(`[data-level=${level}]`) || null;
      };
      const getData = (level) => {
        if (level === null) {
          return null;
        }

        return challangeData[level];
      };
      const changeData = (data) => {
        const title = contentBox.querySelector("h3");
        const text = contentBox.querySelector("p");
        const tests = contentBox.querySelector("ul");

        title.innerHTML = "";
        text.innerHTML = "";
        tests.innerHTML = "";
        if (data === null) {
          return true;
        }
        title.innerHTML = data.title;
        text.innerHTML = data.text;

        for (let i = 0; i < data.tests.length; i++) {
          const element = data.tests[i];
          const list = document.createElement("li");
          list.classList.add(
            "px-2",
            "py-1",
            "rounded",
            "bg-gray-200",
            "text-gray-700",
            "text-sm"
          );
          list.innerText = element;
          tests.appendChild(list);
        }
      };
      const initData = (level) => {
        clearLinkSelection("nav a");
        updateTitle(level);
        if (level == null) {
        } else {
          const ancla = getElementByLevel(level);
          selectLink(ancla);
        }
        changeData(getData(level));
      };
      //
      initData("profesora_furiosa");
      //
      const challengeBTNs = document.querySelectorAll("nav a");
      challengeBTNs.forEach((BTN) => {
        BTN.addEventListener(
          "click",
          (e) => {
            e.preventDefault();
            const ancla = e.currentTarget;
            const title = ancla.querySelector("span").innerText;
            const url = ancla.getAttribute("href");
            const data = ancla.dataset.level;
            history.pushState(data, null, url);
            initData(data);
            e.stopPropagation();
          },
          false
        );
      });

      window.addEventListener("popstate", function (e) {
        const level = e.state;
        initData(level);
      });
    </script>
  </body>
</html>
